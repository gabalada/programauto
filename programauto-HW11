#include <stdio.h>
#include <stdlib.h>
#include <time.h>

void tabuleiro(char tab[3][3]) {
    system("cls");  
    printf("\t %c | %c | %c \n", tab[0][0], tab[0][1], tab[0][2]);
    printf("\t-----------\n");
    printf("\t %c | %c | %c \n", tab[1][0], tab[1][1], tab[1][2]);
    printf("\t-----------\n");
    printf("\t %c | %c | %c \n", tab[2][0], tab[2][1], tab[2][2]);
}

int main(void) {
    char casa[3][3] = { {'1', '2', '3'}, {'4', '5', '6'}, {'7', '8', '9'} };
    char answ;
    int turns, r, c, count_turns;

    srand(time(NULL));

    do {
        count_turns = 0;
        for (int i = 0; i < 3; i++) {
            for (int j = 0; j < 3; j++) {
                casa[i][j] = '1' + (i * 3 + j);  
            }
        }
        turns = 0;
        int game_over = 0;

        do {
            tabuleiro(casa);
            if (turns % 2 == 0) {
                printf("Player X\n");
                do {
                    printf("Please, select the row (1-3): ");
                    scanf("%d", &r);
                    printf("Please, select the column (1-3): ");
                    scanf("%d", &c);
                    if (r < 1 || c < 1 || r > 3 || c > 3 || casa[r-1][c-1] == 'X' || casa[r-1][c-1] == 'O') {
                        printf("Invalid move, try again.\n");
                    } else {
                        break;
                    }
                } while (1);
                casa[r-1][c-1] = 'X';
            } else {
                printf("Machine O\n");
                do {
                    r = rand() % 3 + 1;  
                    c = rand() % 3 + 1;  
                } while (casa[r-1][c-1] == 'X' || casa[r-1][c-1] == 'O');
                casa[r-1][c-1] = 'O';
                printf("Machine chose row %d, column %d\n", r, c);
            }

            turns++;
            count_turns++;

            for (int i = 0; i < 3; i++) {
                if (casa[i][0] == casa[i][1] && casa[i][1] == casa[i][2]) {
                    game_over = (casa[i][0] == 'X') ? 11 : 12;
                }
                if (casa[0][i] == casa[1][i] && casa[1][i] == casa[2][i]) {
                    game_over = (casa[0][i] == 'X') ? 11 : 12;
                }
            }

            if (casa[0][0] == casa[1][1] && casa[1][1] == casa[2][2]) {
                game_over = (casa[0][0] == 'X') ? 11 : 12;
            }
            if (casa[0][2] == casa[1][1] && casa[1][1] == casa[2][0]) {
                game_over = (casa[0][2] == 'X') ? 11 : 12;
            }

            tabuleiro(casa);

            if (game_over == 11) {
                printf("Player X wins!\n");
                break;
            } else if (game_over == 12) {
                printf("Machine O wins!\n");
                break;
            }

        } while (count_turns < 9);

        if (count_turns == 9 && game_over == 0) {
            printf("It's a draw!\n");
        }

        printf("Do you want to play again? (y/n): ");
        scanf(" %c", &answ);

    } while (answ == 'y');

    return 0;
}
